<!doctype html>
<html lang="en" data-theme="light" data-density="comfortable">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SnapBot Dashboard</title>
  <style>
    /* --- Design tokens --------------------------------------------------- */
    :root {
      /* colors */
      --bg: #0b0c0f;           /* will be overridden for light */
      --bg-elev: #12141a;
      --card: #161922;
      --text: #e8eaf1;
      --muted: #a7afc2;
      --border: #2a2f3a;
      --primary: #7aa2ff;
      --primary-ink: #0b1222;
      --success: #27c184;
      --warning: #efaa3d;
      --danger: #f76e6e;

      /* layout */
      --radius: 14px;
      --shadow: 0 6px 24px rgba(0,0,0,.25);

      /* spacing scale (8px base) */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;
      --space-7: 28px;
      --space-8: 32px;

      /* type */
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --fs-0: 12px; /* caption */
      --fs-1: 14px; /* body */
      --fs-2: 16px; /* body+ */
      --fs-3: 20px; /* h4 */
      --fs-4: 24px; /* h3 */

      /* density (comfortable by default) */
      --pad-1: 10px;
      --pad-2: 14px;
      --row-h: 44px;
      --line: 1.5;
    }

    /* Light theme overrides */
    html[data-theme="light"] {
      --bg: #f6f7fb;
      --bg-elev: #ffffff;
      --card: #ffffff;
      --text: #0b1020;
      --muted: #5a6476;
      --border: #e6e8ef;
      --shadow: 0 6px 24px rgba(14, 20, 34, .06);
    }

    /* Dark theme defaults already set in :root */

    /* Compact density overrides */
    html[data-density="compact"] {
      --pad-1: 6px;
      --pad-2: 10px;
      --row-h: 36px;
      --line: 1.35;
    }

    /* --- Base ------------------------------------------------------------ */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: var(--font);
      background: radial-gradient(1200px 600px at 75% -10%, rgba(122,162,255,.08), transparent), var(--bg);
      color: var(--text);
      line-height: var(--line);
      font-size: var(--fs-1);
    }
    a { color: var(--primary); text-decoration: none; }
    a:hover { text-decoration: underline; }
    h1, h2, h3 { margin: 0 0 var(--space-3); letter-spacing: .2px; }
    h1 { font-size: 28px; }
    h2 { font-size: var(--fs-4); }
    h3 { font-size: var(--fs-3); color: var(--muted); }

    /* --- Topbar ---------------------------------------------------------- */
    .topbar {
      position: sticky; top: 0; z-index: 10;
      backdrop-filter: saturate(150%) blur(8px);
      background: color-mix(in oklab, var(--bg-elev) 92%, transparent);
      border-bottom: 1px solid var(--border);
      padding: var(--space-4) clamp(12px, 3vw, 28px);
      display: flex; align-items: center; gap: var(--space-4); justify-content: space-between;
    }
    .topbar .actions { display: flex; flex-wrap: wrap; gap: var(--space-3); align-items: center; }

    /* Controls */
    .select, .button, input, textarea { 
      appearance: none; border: 1px solid var(--border); background: var(--bg-elev); color: var(--text);
      padding: 10px 12px; border-radius: 10px; min-height: var(--row-h); font: inherit;
    }
    .select { display: inline-flex; align-items: center; gap: 8px; }
    .label { font-size: var(--fs-0); color: var(--muted); display: inline-flex; gap: 8px; align-items: center; }

    .button { cursor: pointer; transition: transform .02s ease, background .2s ease, border-color .2s ease; }
    .button:hover { transform: translateY(-1px); }
    .button.primary { background: var(--primary); color: var(--primary-ink); border-color: color-mix(in oklab, var(--primary) 65%, black 10%); }
    .button.ghost { background: transparent; }

    /* --- Layout ---------------------------------------------------------- */
    .container { max-width: 1280px; margin: 0 auto; padding: var(--space-6) clamp(12px, 3vw, 28px); }

    .grid {
      display: grid;
      gap: var(--space-6);
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      align-items: start;
    }
    .wide { grid-column: 1 / -1; }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: var(--space-5);
      display: flex; flex-direction: column; gap: var(--space-4);
      min-width: 0;
    }

    /* Panels content */
    .panel-header { display: flex; align-items: baseline; justify-content: space-between; gap: var(--space-3); }
    .hint { color: var(--muted); font-size: var(--fs-0); }

    /* Tables */
    .table-wrap { overflow: auto; --mask: linear-gradient(90deg, transparent, #000 12px, #000 calc(100% - 12px), transparent); -webkit-mask-image: var(--mask); mask-image: var(--mask); }
    table { width: 100%; border-collapse: collapse; font-size: var(--fs-1); }
    thead th { position: sticky; top: 0; background: var(--bg-elev); color: var(--muted); text-align: left; font-weight: 600; }
    th, td { padding: 10px 12px; border-bottom: 1px solid var(--border); white-space: nowrap; }
    tbody tr:hover { background: color-mix(in oklab, var(--bg-elev) 85%, white 0%); }
    td .chip { padding: 4px 8px; border-radius: 999px; border: 1px solid var(--border); font-size: var(--fs-0); }
    .status-ok { background: color-mix(in oklab, var(--success) 18%, transparent); border-color: color-mix(in oklab, var(--success) 50%, var(--border)); color: color-mix(in oklab, var(--success) 80%, black); }
    .status-warn { background: color-mix(in oklab, var(--warning) 20%, transparent); border-color: color-mix(in oklab, var(--warning) 45%, var(--border)); color: color-mix(in oklab, var(--warning) 75%, black); }
    .status-bad { background: color-mix(in oklab, var(--danger) 20%, transparent); border-color: color-mix(in oklab, var(--danger) 50%, var(--border)); color: color-mix(in oklab, var(--danger) 80%, black); }

    /* Forms */
    .form-row { display: grid; gap: var(--space-3); grid-template-columns: repeat(12, 1fr); }
    .form-row > label { grid-column: span 3; display: grid; gap: 6px; align-content: start; }
    .form-row > label.grow { grid-column: span 6; }
    .form-row + .form-row { margin-top: var(--space-3); }

    @media (max-width: 900px) {
      .form-row > label { grid-column: span 12; }
      .form-row > label.grow { grid-column: span 12; }
      .topbar { align-items: start; }
    }

    /* Lists */
    .two-col { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap: var(--space-4); }
    ul { list-style: none; padding: 0; margin: 0; display: grid; gap: 8px; }
    ul li { padding: 8px 10px; border: 1px dashed var(--border); border-radius: 10px; background: color-mix(in oklab, var(--bg-elev) 90%, transparent); }

    /* Footer */
    .footer { border-top: 1px solid var(--border); padding: var(--space-5) clamp(12px, 3vw, 28px); color: var(--muted); }

    /* Code blocks */
    .pre { background: var(--bg-elev); border: 1px solid var(--border); border-radius: 10px; padding: var(--space-4); font-family: var(--mono); overflow: auto; }

    /* --- Modals ---------------------------------------------------------- */
    .modal[hidden] { display: none !important; }
    .modal {
      position: fixed; inset: 0; z-index: 50; display: grid; place-items: center;
      background: color-mix(in oklab, var(--bg), transparent 50%);
      padding: var(--space-6);
    }
    .modal-dialog {
      width: min(860px, 100%);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: calc(var(--radius) + 4px);
      box-shadow: var(--shadow);
      display: grid; gap: 0;
      max-height: 90vh; overflow: hidden;
    }
    .modal-header, .modal-footer { display: flex; align-items: center; justify-content: space-between; gap: var(--space-3); padding: var(--space-4) var(--space-5); border-bottom: 1px solid var(--border); }
    .modal-footer { border-top: 1px solid var(--border); border-bottom: none; }
    .modal-body { padding: var(--space-5); display: grid; gap: var(--space-4); overflow: auto; }
    .modal-close { border: 0; background: transparent; color: var(--muted); font-size: 24px; cursor: pointer; line-height: 1; }

    /* Utilities */
    .row { display: flex; gap: var(--space-3); align-items: center; flex-wrap: wrap; }
    .spacer { flex: 1 1 auto; }
  </style>
</head>
<body>
  <a class="label" href="#main" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">Skip to content</a>

  <header class="topbar">
    <h1>SnapBot Dashboard</h1>
    <div class="actions">
      <label class="label">Theme
        <select id="themeSelect" class="select">
          <option value="light" selected>Light</option>
          <option value="dark">Dark</option>
          <option value="system">System</option>
        </select>
      </label>
      <label class="label">Density
        <select id="densitySelect" class="select">
          <option value="comfortable" selected>Comfortable</option>
          <option value="compact">Compact</option>
        </select>
      </label>
      <button id="refreshBtn" class="button" title="Refresh data">Refresh</button>
    </div>
  </header>

  <main id="main" class="container">
    <div class="grid">
      <!-- Health -->
      <section class="card" id="healthCard">
        <div class="panel-header"><h2>Health</h2><span class="hint">Live service status</span></div>
        <div id="health"></div>
      </section>

      <!-- Stats -->
      <section class="card" id="statsCard">
        <div class="panel-header"><h2>Stats</h2><span class="hint">Today & 30‑day</span></div>
        <div id="stats"></div>
      </section>

      <!-- Recent Jobs -->
      <section class="card wide" id="jobsCard">
        <div class="panel-header"><h2>Recent Jobs</h2><span class="hint">Newest first</span></div>
        <div class="table-wrap">
          <table id="jobsTable">
            <thead>
              <tr>
                <th>Id</th>
                <th>Type</th>
                <th>Status</th>
                <th>Created</th>
                <th>Updated</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Filters -->
      <section class="card" id="filtersCard">
        <h2>Filters</h2>
        <div class="two-col">
          <div>
            <h3>Whitelist</h3>
            <ul id="whitelist"></ul>
          </div>
          <div>
            <h3>Blacklist</h3>
            <ul id="blacklist"></ul>
          </div>
        </div>
        <form id="filterForm" class="form-row" autocomplete="off">
          <label>
            <span class="label">Mode</span>
            <select name="mode" class="select">
              <option value="whitelist">Whitelist</option>
              <option value="blacklist">Blacklist</option>
            </select>
          </label>
          <label class="grow">
            <span class="label">Value (Display Name)</span>
            <input name="value" placeholder="e.g. Team Snapchat" required />
          </label>
          <div style="display:grid;align-content:end;">
            <button type="submit" class="button primary">Add</button>
          </div>
        </form>
      </section>

      <!-- Endpoints -->
      <section class="card wide" id="endpointsCard">
        <div class="panel-header"><h2>Endpoints</h2><span class="hint">HTTP API</span></div>
        <div class="table-wrap">
          <table id="endpointsTable">
            <thead>
              <tr>
                <th>Method</th>
                <th>Path</th>
                <th>Description</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Recipients -->
      <section class="card wide" id="recipientsCard">
        <div class="panel-header"><h2>Recipients</h2><span class="hint">Load from an existing Chrome profile for fewer CAPTCHAs</span></div>
        <form id="recipientsForm" class="form-row" autocomplete="off">
          <label>
            <span class="label">Headless</span>
            <select name="headless" class="select">
              <option value="true">true</option>
              <option value="false" selected>false</option>
            </select>
          </label>
          <label>
            <span class="label">Limit</span>
            <input type="number" name="limit" value="100" min="1" />
          </label>
          <label class="grow">
            <span class="label">userDataDir (optional)</span>
            <input name="userDataDir" placeholder="C:\\Users\\...\\Chrome\\User Data\\Default" />
          </label>
          <div style="display:grid;align-content:end;">
            <button type="submit" class="button primary">Load Recipients</button>
          </div>
        </form>
        <div class="table-wrap" style="margin-top:10px;">
          <table id="recipientsTable">
            <thead>
              <tr>
                <th>Id</th>
                <th>Name</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <p class="hint">Tip: Use <code class="pre" style="display:inline-block;padding:2px 6px;">userDataDir</code> for a logged‑in Chrome profile to avoid CAPTCHA.</p>
      </section>
    </div>
  </main>

  <footer class="footer">
    <span>© SnapBot</span>
  </footer>

  <!-- Run Sample Modal -->
  <div class="modal" id="runModal" hidden>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="runModalTitle">
      <header class="modal-header">
        <h3 id="runModalTitle">Run Sample</h3>
        <button class="modal-close" data-close aria-label="Close">&times;</button>
      </header>
      <div class="modal-body">
        <div class="form-row">
          <label>
            <span class="label">Method</span>
            <input id="runMethod" readonly />
          </label>
          <label class="grow">
            <span class="label">Path</span>
            <input id="runPath" readonly />
          </label>
        </div>
        <div class="warning hint" id="runWarning" hidden></div>
        <label>
          <span class="label">Payload (JSON)</span>
          <textarea id="runPayload" rows="10" spellcheck="false"></textarea>
        </label>
        <pre id="runResult" class="pre"></pre>
      </div>
      <footer class="modal-footer">
        <button class="button" data-close>Cancel</button>
        <button id="runSendBtn" class="button primary">Send</button>
      </footer>
    </div>
  </div>

  <!-- Job Logs Modal -->
  <div class="modal" id="logsModal" hidden>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="logsTitle">
      <header class="modal-header">
        <h3 id="logsTitle">Job Logs</h3>
        <button class="modal-close" data-close aria-label="Close">&times;</button>
      </header>
      <div class="modal-body">
        <div class="form-row">
          <label class="grow">
            <span class="label">Job ID</span>
            <input id="logsJobId" readonly />
          </label>
        </div>
        <pre id="logsStream" class="pre" style="max-height:340px;"></pre>
      </div>
      <footer class="modal-footer">
        <button id="logsExportBtn" class="button">Export</button>
        <button class="button" data-close>Close</button>
      </footer>
    </div>
  </div>

  <!--
    Keep your existing /app.js if you have one. The tiny script below just wires theme/density to CSS variables
    and makes the modal [hidden] toggles accessible. It won't conflict with most app.js setups.
  -->
  <script>
    (function() {
      const html = document.documentElement;
      const themeSel = document.getElementById('themeSelect');
      const densSel = document.getElementById('densitySelect');

      function applyTheme(v) {
        if (v === 'system') {
          const prefersDark = matchMedia('(prefers-color-scheme: dark)').matches;
          html.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
        } else {
          html.setAttribute('data-theme', v);
        }
      }
      function applyDensity(v) { html.setAttribute('data-density', v); }

      themeSel?.addEventListener('change', e => applyTheme(e.target.value));
      densSel?.addEventListener('change', e => applyDensity(e.target.value));
      applyTheme(themeSel?.value || 'light');
      applyDensity(densSel?.value || 'comfortable');

      // Modal open/close helpers (toggle the [hidden] attribute)
      document.addEventListener('click', (e) => {
        const t = e.target;
        if (t.matches('[data-open]')) {
          const id = t.getAttribute('data-open');
          const modal = document.getElementById(id);
          if (modal) modal.hidden = false;
        }
        if (t.matches('[data-close], .modal')) {
          const modal = t.closest('.modal') || t;
          if (modal?.classList.contains('modal')) modal.hidden = true;
        }
      });
    })();
  </script>
  <script src="/app.js"></script>
</body>
</html>
